# Sprint D0 - Basic Docker Setup - Implementation

## –°—Ç–∞—Ç—É—Å: ‚úÖ Completed

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 18 –æ–∫—Ç—è–±—Ä—è 2025

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è Docker –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ TEA –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up`.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –°–æ–∑–¥–∞–Ω–∏–µ .dockerignore —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª—ã:**
- `.dockerignore` (–∫–æ—Ä–Ω–µ–≤–æ–π) - –¥–ª—è Bot –∏ API —Å–µ—Ä–≤–∏—Å–æ–≤
- `frontend/.dockerignore` - –¥–ª—è Frontend —Å–µ—Ä–≤–∏—Å–∞

**–ò—Å–∫–ª—é—á–µ–Ω—ã:**
- Python –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (__pycache__, *.pyc)
- Node modules –∏ build –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
- IDE –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –õ–æ–≥–∏ –∏ —Ç–µ—Å—Ç—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### ‚úÖ 2. –°–æ–∑–¥–∞–Ω–∏–µ Dockerfile –¥–ª—è Bot

**–§–∞–π–ª:** `Dockerfile.bot`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Base image: `python:3.11-slim`
- Package manager: `uv`
- –ó–∞–ø—É—Å–∫: `uv run python -m src.main`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```dockerfile
FROM python:3.11-slim
WORKDIR /app
RUN pip install --no-cache-dir uv
COPY pyproject.toml uv.lock ./
RUN uv sync --frozen
COPY src/ ./src/
COPY prompts/ ./prompts/
COPY alembic/ ./alembic/
COPY alembic.ini ./
CMD ["uv", "run", "python", "-m", "src.main"]
```

### ‚úÖ 3. –°–æ–∑–¥–∞–Ω–∏–µ Dockerfile –¥–ª—è API

**–§–∞–π–ª:** `Dockerfile.api`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Base image: `python:3.11-slim`
- Package manager: `uv`
- –ó–∞–ø—É—Å–∫: `uvicorn` –Ω–∞ –ø–æ—Ä—Ç—É 8001

**–û—Ç–ª–∏—á–∏—è –æ—Ç Bot:**
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 8001
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç prompts/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ uvicorn

### ‚úÖ 4. –°–æ–∑–¥–∞–Ω–∏–µ Dockerfile –¥–ª—è Frontend

**–§–∞–π–ª:** `frontend/Dockerfile`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Base image: `node:20-alpine`
- Package manager: `pnpm`
- –†–µ–∂–∏–º: Development (`pnpm dev`)
- –ü–æ—Ä—Ç: 3000

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç corepack –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ pnpm
- Hot-reload —á–µ—Ä–µ–∑ volume mount
- Frozen lockfile –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### ‚úÖ 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml

**–î–æ–±–∞–≤–ª–µ–Ω–æ 3 –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–∞:**

1. **bot** - Telegram –±–æ—Ç
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç postgres (healthcheck)
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env
   - Volume –¥–ª—è –ª–æ–≥–æ–≤: `./logs:/app/logs`

2. **api** - FastAPI —Å–µ—Ä–≤–µ—Ä
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç postgres (healthcheck)
   - –ü–æ—Ä—Ç: 8001
   - –¢–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á—Ç–æ —É –±–æ—Ç–∞

3. **frontend** - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç api
   - –ü–æ—Ä—Ç: 3000
   - Volume –¥–ª—è hot-reload
   - Environment: NEXT_PUBLIC_API_URL

**Healthcheck –¥–ª—è PostgreSQL:**
```yaml
healthcheck:
  test: ["CMD-SHELL", "pg_isready -U telegrambot"]
  interval: 10s
  timeout: 5s
  retries: 5
```

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞:**
1. PostgreSQL (—Å healthcheck)
2. Bot –∏ API (–∂–¥—É—Ç healthy postgres)
3. Frontend (–∂–¥–µ—Ç api)

### ‚úÖ 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README.md

**–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker":**

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞)
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ .env
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (up -d, logs, down, rebuild)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- Troubleshooting (3 —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

**–î–æ–±–∞–≤–ª–µ–Ω badge:**
```markdown
[![Docker](https://img.shields.io/badge/docker-ready-blue.svg)](https://www.docker.com/)
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –í—Å–µ 4 —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up` | ‚úÖ |
| PostgreSQL –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –¥–æ –∑–∞–ø—É—Å–∫–∞ Bot –∏ API | ‚úÖ |
| Bot –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram –∏ –ë–î | ‚úÖ |
| API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8001/docs | ‚úÖ |
| Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:3000 | ‚úÖ |
| –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `logs/` | ‚úÖ |
| Hot-reload —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è frontend | ‚úÖ |
| .dockerignore –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã | ‚úÖ |
| README.md —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ Docker | ‚úÖ |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
TEARepo/
‚îú‚îÄ‚îÄ .dockerignore                          # NEW ‚úÖ
‚îú‚îÄ‚îÄ Dockerfile.bot                         # NEW ‚úÖ
‚îú‚îÄ‚îÄ Dockerfile.api                         # NEW ‚úÖ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ .dockerignore                      # NEW ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile                         # NEW ‚úÖ
‚îú‚îÄ‚îÄ docker-compose.yml                     # UPDATED ‚úÖ
‚îî‚îÄ‚îÄ README.md                              # UPDATED ‚úÖ
```

## –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞

```bash
# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª —Å —Ç–æ–∫–µ–Ω–∞–º–∏
TELEGRAM_BOT_TOKEN=your_token
OPENROUTER_API_KEY=your_key

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up

# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec bot uv run alembic upgrade head
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ URL:**
- Frontend: http://localhost:3000
- API Docs: http://localhost:8001/docs
- PostgreSQL: localhost:5432

## –ß—Ç–æ –ù–ï –≤–∫–ª—é—á–µ–Ω–æ (Future work)

–°–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–ø—Ä–∏–Ω—Ç—ã:

- ‚ùå Multi-stage builds (D1)
- ‚ùå Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (D2)
- ‚ùå CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ (D1)
- ‚ùå –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤ –≤ GitHub Container Registry (D1)
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (D2)
- ‚ùå Healthchecks –¥–ª—è Bot –∏ API (D2)
- ‚ùå Hadolint –ø—Ä–æ–≤–µ—Ä–∫–∏ Dockerfile (D1)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### MVP –ø–æ–¥—Ö–æ–¥

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- –ü—Ä–æ—Å—Ç—ã–µ single-stage Dockerfile
- Dev —Ä–µ–∂–∏–º –¥–ª—è frontend (–±—ã—Å—Ç—Ä—ã–π hot-reload)
- –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–æ–≤
- –ë–µ–∑ production-specific –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. **–ò–∑–æ–ª—è—Ü–∏—è** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –≤ —Å–≤–æ–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
3. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º** - frozen lockfiles –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - healthcheck –∏ depends_on –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞
5. **–£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - hot-reload –¥–ª—è frontend, volume –¥–ª—è –ª–æ–≥–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**Healthcheck –¥–ª—è PostgreSQL:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ë–î –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: 10 —Å–µ–∫—É–Ω–¥
- Timeout: 5 —Å–µ–∫—É–Ω–¥
- Retries: 5 –ø–æ–ø—ã—Ç–æ–∫

**Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑ .env —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ docker-compose
- DATABASE_URL —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (service name "postgres")
- Default values –≤ docker-compose.yml –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**Volumes:**
- `./logs:/app/logs` - –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –±–æ—Ç–∞
- `./frontend:/app` - hot-reload –¥–ª—è frontend
- `/app/node_modules` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–æ–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Sprint D1** - Build & Publish
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤ –≤ ghcr.io
   - Multi-stage builds –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

2. **Sprint D2** - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - Production docker-compose.yml
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä—É—á–Ω–æ–º—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

3. **Sprint D3** - Auto Deploy
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ GitHub Actions
   - Workflow dispatch –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞

