# ‚úÖ Sprint S1 –ó–∞–≤–µ—Ä—à–µ–Ω

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 16.10.2025

## üéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL. –ò—Å—Ç–æ—Ä–∏—è —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –±–æ—Ç–∞.

---

## üì¶ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL ‚úÖ
- –ù–∞—Å—Ç—Ä–æ–µ–Ω Docker Compose —Å PostgreSQL 16
- –°–æ–∑–¥–∞–Ω–∞ —Å—Ö–µ–º–∞ –ë–î —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `users` –∏ `messages`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω soft delete (is_deleted —Ñ–ª–∞–≥)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `created_at`, `content_length`

### 2. SQLAlchemy ORM ‚úÖ
- –°–æ–∑–¥–∞–Ω—ã –º–æ–¥–µ–ª–∏ User –∏ Message
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã relationships –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ (async/await)

### 3. Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ ‚úÖ
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω Alembic
- –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î
- –ù–∞—Å—Ç—Ä–æ–µ–Ω async —Ä–µ–∂–∏–º –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

### 4. Repository –ø–∞—Ç—Ç–µ—Ä–Ω ‚úÖ
- –°–æ–∑–¥–∞–Ω `MessageRepository` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –ú–µ—Ç–æ–¥—ã: get_or_create_user, add_message, get_history, clear_history
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### 5. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚úÖ
- –ó–∞–º–µ–Ω—ë–Ω in-memory Conversation –Ω–∞ Repository
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/clear` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–ø—Ä–∞–≤–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ
- –û–±–Ω–æ–≤–ª—ë–Ω README.md —Å –Ω–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- –°–æ–∑–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- –û–±–Ω–æ–≤–ª—ë–Ω roadmap.md

---

## üöÄ –ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make setup

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
docker-compose up -d

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
uv run alembic upgrade head

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
make run
```

### –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:

- `/clear` - –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞

---

## üìÇ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥
- `src/db/__init__.py` - –º–æ–¥—É–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `src/db/models.py` - SQLAlchemy –º–æ–¥–µ–ª–∏
- `src/db/database.py` - engine –∏ session management
- `src/db/repository.py` - Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- `docker-compose.yml` - PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- `alembic.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
- `alembic/env.py` - async –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- `alembic/versions/e7d81f36ca19_initial_schema.py` - –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `doc/sprint-s1-implementation.md` - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `doc/sprint-s1-summary.md` - –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ
- `doc/deployment-guide.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- **SQLAlchemy 2.x** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (async)
- **asyncpg** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **Alembic 1.13+** - –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`
- `id` - PK, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
- `telegram_id` - bigint, unique, indexed
- `username` - varchar(255), nullable
- `created_at` - timestamp, default now()
- `is_deleted` - boolean, default false

### –¢–∞–±–ª–∏—Ü–∞ `messages`
- `id` - PK, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
- `user_id` - FK -> users.id (ON DELETE CASCADE)
- `role` - varchar(20) ("user" –∏–ª–∏ "assistant")
- `content` - text
- `content_length` - integer (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è)
- `created_at` - timestamp, default now(), indexed
- `is_deleted` - boolean, default false, indexed

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
3. ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ max_history_messages
4. ‚úÖ –ö–æ–º–∞–Ω–¥—É /clear –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
5. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –±–æ—Ç–∞

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **README.md** - –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- **doc/sprint-s1-implementation.md** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **doc/sprint-s1-summary.md** - –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ —Å–ø—Ä–∏–Ω—Ç–∞
- **doc/deployment-guide.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **doc/roadmap.md** - –æ–±–Ω–æ–≤–ª—ë–Ω —Å—Ç–∞—Ç—É—Å —Å–ø—Ä–∏–Ω—Ç–∞

---

## üéì –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **KISS –ø—Ä–∏–Ω—Ü–∏–ø** - –ø—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞ –ë–î –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
2. **Async –≤—Å—é–¥—É** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
3. **Soft delete** - —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. **Repository –ø–∞—Ç—Ç–µ—Ä–Ω** - –∏–∑–æ–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ –ë–î –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - created_at –∏ content_length

---

## üîÑ –ß—Ç–æ –¥–∞–ª—å—à–µ?

Sprint S1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à—ë–Ω! –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î
- –°–ª–µ–¥—É—é—â–µ–º—É —Å–ø—Ä–∏–Ω—Ç—É –∏–∑ roadmap.md

---

## ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. üíæ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
2. üóëÔ∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π** - –∫–æ–º–∞–Ω–¥–∞ /clear –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
3. üìä **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –¥–ª–∏–Ω–∞ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
4. üîÑ **Soft delete** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**

–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞, –∫–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

---

üìñ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: [sprint-s1-implementation.md](doc/sprint-s1-implementation.md)
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é: [deployment-guide.md](doc/deployment-guide.md)
- Roadmap –ø—Ä–æ–µ–∫—Ç–∞: [roadmap.md](doc/roadmap.md)

